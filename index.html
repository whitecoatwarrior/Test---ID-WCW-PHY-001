<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHITE COAT WARRIORS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All CSS styles remain the same as in the original file */
        :root {
            --primary-blue: #1a56db;
            --secondary-blue: #0ea5e9;
            --dark-blue: #1e3a8a;
            --light-blue: #dbeafe;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-teal: #14b8a6;
            --accent-yellow: #fbbf24;
            --accent-amber: #f59e0b;
            --vibrant-blue: #3b82f6;
            --vibrant-green: #22c55e;
            --vibrant-purple: #a855f7;
            --vibrant-pink: #e879f9;
            --gradient-blue: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            --gradient-green: linear-gradient(135deg, var(--accent-green), #34d399);
            --gradient-orange: linear-gradient(135deg, var(--accent-orange), #f97316);
            --gradient-red: linear-gradient(135deg, var(--accent-red), #f87171);
            --gradient-purple: linear-gradient(135deg, var(--accent-purple), #a78bfa);
            --gradient-pink: linear-gradient(135deg, var(--accent-pink), #f472b6);
            --gradient-teal: linear-gradient(135deg, var(--accent-teal), #2dd4bf);
            --gradient-yellow: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
            --gradient-vibrant: linear-gradient(135deg, #4f46e5, #7c3aed, #ec4899);
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 2px 5px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 5px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px;
            color: #1e3a8a;
            font-size: 8.25px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .logo {
            text-align: center;
            margin-bottom: 9px;
        }

        .logo h1 {
            font-size: 1.05rem;
            font-weight: 800;
            color: var(--dark-blue);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5px;
            background: var(--gradient-vibrant);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            color: var(--primary-blue);
            font-weight: 600;
            font-size: 0.525rem;
        }

        .page {
            background: white;
            border-radius: 9px;
            padding: 9px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            display: none;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
        }

        .active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .promo-banner {
            background: var(--gradient-vibrant);
            color: white;
            padding: 11.25px;
            border-radius: 7.5px;
            margin-bottom: 11.25px;
            text-align: center;
            font-size: 0.45rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .promo-banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            z-index: 1;
        }

        .promo-banner h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
        }

        .promo-banner p {
            line-height: 1.4;
            text-align: justify;
            position: relative;
            z-index: 2;
        }

        .form-group {
            margin-bottom: 6px;
        }

        .form-label {
            display: block;
            margin-bottom: 1.5px;
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 0.525rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 4.5px 6.75px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            font-size: 0.525rem;
            background: #f8fafc;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 86, 219, 0.15);
        }

        .input-container {
            position: relative;
        }

        .password-container .form-input {
            padding-right: 22.5px;
        }

        .input-icon {
            position: absolute;
            right: 7.5px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-blue);
            font-size: 0.525rem;
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4.5px 7.5px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.525rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            gap: 3px;
            width: 100%;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-blue);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(26, 86, 219, 0.2);
        }

        .btn-contact {
            background: var(--gradient-green);
            color: white;
        }

        .btn-contact:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .btn-whatsapp:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
        }

        .btn-purple {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-purple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
        }

        .btn-red {
            background: var(--gradient-red);
            color: white;
        }

        .btn-red:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }

        .btn-orange {
            background: var(--gradient-orange);
            color: white;
        }

        .btn-orange:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .error-box {
            background: #fee2e2;
            color: var(--accent-red);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-red);
        }

        .success-box {
            background: #d1fae5;
            color: var(--accent-green);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-green);
        }

        .notification-box {
            background: #fef3c7;
            color: #d97706;
            padding: 7.5px;
            border-radius: 4.5px;
            margin-top: 7.5px;
            font-weight: 600;
            font-size: 0.525rem;
            text-align: center;
            border-left: 3px solid #f59e0b;
        }

        .quiz-notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            padding: 11.25px;
            border-radius: 7.5px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            display: none;
            max-width: 225px;
            border-left: 3.75px solid var(--accent-green);
            animation: slideInRight 0.3s ease;
            transform: translateX(100%);
        }

        .quiz-notification.show {
            display: block;
            transform: translateX(0);
        }

        .quiz-notification.warning {
            border-left-color: var(--accent-orange);
        }

        .quiz-notification.error {
            border-left-color: var(--accent-red);
        }

        .quiz-notification-content {
            display: flex;
            flex-direction: column;
            gap: 7.5px;
        }

        .quiz-notification-title {
            font-weight: 700;
            font-size: 0.6rem;
            color: var(--dark-blue);
        }

        .quiz-notification-message {
            font-size: 0.525rem;
            color: #4b5563;
        }

        .quiz-notification-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .quiz-notification-btn {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.4875rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .quiz-notification-btn.primary {
            background: var(--gradient-blue);
            color: white;
        }

        .quiz-notification-btn.secondary {
            background: #f3f4f6;
            color: #4b5563;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .main-page-buttons {
            display: grid;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-access-section {
            display: none;
            flex-direction: column;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
            padding-bottom: 4.5px;
            border-bottom: 1.5px solid var(--light-blue);
        }

        .quiz-title-container {
            display: flex;
            flex-direction: column;
            gap: 2.25px;
            width: 80%;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.525rem;
            color: var(--dark-blue);
            font-weight: 600;
        }

        .timer-container {
            display: flex;
            gap: 4.5px;
            justify-content: flex-end;
            width: 100%;
        }

        .timer, .question-timer {
            background: var(--gradient-blue);
            color: white;
            padding: 2.25px 4.5px;
            border-radius: 7.5px;
            font-weight: 700;
            font-size: 0.525rem;
            box-shadow: var(--shadow);
            white-space: nowrap;
        }

        .timer.total-timer {
            background: var(--gradient-orange);
        }

        .progress-container {
            width: 100%;
            height: 4.5px;
            background: #e5e7eb;
            border-radius: 2.25px;
            overflow: hidden;
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 100%;
            border-radius: 2.25px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(10.5px, 1fr));
            gap: 2.25px;
            margin-bottom: 6px;
        }

        .question-nav-item {
            width: 10.5px;
            height: 10.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2.25px;
            font-weight: 700;
            font-size: 0.375rem;
            cursor: pointer;
            background: white;
            border: 1.5px solid var(--light-blue);
            transition: all 0.2s;
        }

        .question-nav-item.current {
            background: var(--gradient-vibrant);
            color: white;
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }

        .question-nav-item.solved {
            background: var(--gradient-green);
            color: white;
            border-color: var(--accent-green);
        }

        .question-nav-item.visited {
            background: var(--gradient-orange);
            color: white;
            border-color: var(--accent-orange);
        }

        .question-container {
            margin-bottom: 6px;
        }

        .question-text {
            font-size: 0.5625rem;
            font-weight: 700;
            margin-bottom: 4.5px;
            color: var(--dark-blue);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3px;
            margin-bottom: 6px;
        }

        .option {
            padding: 3.75px 6px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            background: #f8fafc;
            font-size: 0.525rem;
            position: relative;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: #e0f2fe;
            transform: translateY(-1px);
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: #dbeafe;
        }

        .option.correct {
            border-color: var(--accent-green);
            background: #d1fae5;
        }

        .option.incorrect {
            border-color: var(--accent-red);
            background: #fee2e2;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .reasoning {
            background: #f8fafc;
            border-radius: 3.75px;
            padding: 6px;
            margin-top: 6px;
            display: none;
            border-left: 2.25px solid var(--primary-blue);
            font-size: 0.525rem;
        }

        .reasoning-title {
            font-weight: 700;
            margin-bottom: 3px;
            color: var(--dark-blue);
            font-size: 0.5625rem;
        }

        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 9px;
        }

        .nav-btn {
            padding: 3.75px 5.25px;
            border-radius: 3.75px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 0.525rem;
            display: flex;
            align-items: center;
            gap: 2.25px;
            justify-content: center;
            width: 100%;
        }

        .btn-back {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }

        .btn-next {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
            color: white;
        }

        .btn-reasoning {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-reasoning.disabled {
            background: #dc3545;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-reasoning.disabled:hover {
            background: #dc3545;
            transform: none;
            box-shadow: none;
        }

        .btn-submit {
            background: var(--gradient-green);
            color: white;
        }

        .results-header-buttons {
            display: flex;
            flex-direction: column;
            gap: 3.75px;
            margin-bottom: 9px;
        }

        .results-header-buttons .btn {
            padding: 3px 4.5px;
            font-size: 0.4875rem;
            width: 100%;
        }

        .result-card {
            background: linear-gradient(135deg, #f8fafc, #e0f2fe);
            border-radius: 6px;
            padding: 9px;
            text-align: center;
            margin-bottom: 9px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .result-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-vibrant);
        }

        .result-card h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: var(--dark-blue);
        }

        .result-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.525rem;
            margin-top: 6px;
            box-shadow: var(--shadow);
        }

        .result-card th, .result-card td {
            padding: 3.75px;
            border: 1px solid #dbeafe;
            text-align: left;
        }

        .result-card th {
            background-color: var(--light-blue);
            font-weight: 600;
        }

        .result-card td {
            background-color: #f8fafc;
        }

        .result-actions {
            display: flex;
            flex-direction: column;
            gap: 4.5px;
            margin-top: 9px;
        }

        .all-mcqs-list {
            display: flex;
            flex-direction: column;
            gap: 11.25px;
        }

        .all-mcq-item {
            padding: 7.5px;
            border: 1px solid var(--light-blue);
            border-radius: 6px;
            background: #f8fafc;
            position: relative;
        }

        .all-mcq-item .question-text {
            color: var(--dark-blue);
            font-size: 0.6rem;
            font-weight: 700;
        }

        .all-mcq-options {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 4.5px;
        }

        .all-mcq-option {
            font-size: 0.525rem;
            padding: 3px 4.5px;
            border-radius: 3px;
            border: 1px solid #e5e7eb;
        }

        .all-mcq-option.correct {
            background: #d1fae5;
            color: var(--accent-green);
            font-weight: 600;
            border-color: #a7f3d0;
        }

        .all-mcq-reasoning {
            margin-top: 6px;
            font-size: 0.525rem;
            color: #4b5563;
            padding: 6px;
            background: #f8fafc;
            border-radius: 3px;
            border-left: 2.25px solid var(--primary-blue);
        }

        .all-mcq-reasoning strong {
            color: var(--dark-blue);
        }

        .quick-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 9px;
            gap: 6px;
        }

        .stat-card {
            flex: 1;
            background: white;
            border-radius: 4.5px;
            padding: 6px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 2px solid var(--primary-blue);
        }

        .stat-card.correct {
            border-top-color: var(--accent-green);
        }

        .stat-card.incorrect {
            border-top-color: var(--accent-red);
        }

        .stat-card.unanswered {
            border-top-color: var(--accent-orange);
        }

        .stat-value {
            font-size: 0.9rem;
            font-weight: 800;
            margin-bottom: 1.5px;
        }

        .stat-label {
            font-size: 0.4875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .performance-meter {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin: 6px 0;
        }

        .performance-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        @media (max-width: 768px) {
            .quiz-header {
                flex-direction: column;
                gap: 4.5px;
                align-items: flex-start;
            }
            
            .navigation-buttons {
                grid-template-columns: 1fr;
            }
            
            .timer-container {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 3.75px;
                justify-content: flex-end;
                width: 100%;
            }
            
            .quiz-title-container {
                width: 100%;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .promo-banner {
                padding: 9px;
            }
            
            .promo-banner h2 {
                font-size: 0.6rem;
            }
            
            .promo-banner p {
                font-size: 0.4125rem;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-notification" id="quiz-notification">
        <div class="quiz-notification-content">
            <div class="quiz-notification-title" id="notification-title">Quiz Progress Found</div>
            <div class="quiz-notification-message" id="notification-message">You have an unfinished quiz. Do you want to continue where you left off?</div>
            <div class="quiz-notification-actions">
                <button class="quiz-notification-btn secondary" id="notification-no">Start Fresh</button>
                <button class="quiz-notification-btn primary" id="notification-yes">Continue</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="logo">
            <h1>WHITE COAT WARRIORS</h1>
            <p>Excellence in Educational Assessment</p>
        </div>

        <div id="signin-page" class="page active">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-lock"></i> Access Test</h2>
            <p>Sign in or use your access code</p>
            
            <div class="main-page-buttons">
                <button class="btn btn-primary" onclick="showQuizAccessForm()">
                    <i class="fas fa-key"></i>
                    <span>Sign In with Quiz Access Code</span>
                </button>
                <button class="btn btn-primary" onclick="showRegistrationPage()">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up to Get Quiz Access</span>
                </button>
                <button class="btn btn-purple" onclick="showDeveloperAccessForm()">
                    <i class="fas fa-code"></i>
                    <span>Developer Access</span>
                </button>
            </div>
            
            <div id="developer-access-form" class="quiz-access-section">
                <h3><i class="fas fa-user-secret"></i> Developer Login</h3>
                <div class="password-container input-container">
                    <input type="password" id="developerPassword" class="form-input" placeholder="Enter the Developer Password">
                    <i class="fas fa-eye-slash input-icon" id="toggleDeveloperPassword"></i>
                </div>
                <button class="btn btn-purple" onclick="checkDeveloperPassword()">
                    <span>Log In</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="dev-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid developer password.
                </div>
            </div>
            
            <div id="quiz-access-form" class="quiz-access-section">
                <h3><i class="fas fa-key"></i> Enter Quiz Access Code</h3>
                <div class="password-container input-container">
                    <input type="password" id="quizAccessCode" class="form-input" placeholder="Enter your 12-Digit Quiz Access Code here">
                    <i class="fas fa-eye-slash input-icon" id="toggleQuizAccessCode"></i>
                </div>
                <button class="btn btn-primary" onclick="accessQuiz(document.getElementById('quizAccessCode').value)">
                    <span>Access Quiz</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="quiz-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid quiz access code.
                </div>
            </div>
            
        </div>

        <div id="registration-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-user-edit"></i> Student Registration</h2>
            <p>Please provide your details to register</p>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user"></i> Student Name</label>
                <input type="text" id="studentName" class="form-input" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user-friends"></i> Father Name</label>
                <input type="text" id="fatherName" class="form-input" placeholder="Enter your father's name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" id="email" class="form-input" placeholder="Enter your email address">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-phone"></i> Mobile Number (WhatsApp)</label>
                <input type="tel" id="mobile" class="form-input" placeholder="+92XXXXXXXXXX">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-city"></i> City / District</label>
                <input type="text" id="city" class="form-input" placeholder="Enter your city/district">
            </div>
            <button class="btn btn-primary" onclick="handleRegistration()">
                <span>Submit to Get Access to Quiz</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-red" style="margin-top: 3.75px;" onclick="showPage('signin-page')">
                <i class="fas fa-chevron-left"></i> Back to Home
            </button>
        </div>

        <div id="quiz-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>

            <div class="quiz-header">
                <div class="quiz-title-container">
                    <h2 id="quiz-title"></h2>
                    <div class="quiz-info">
                        <span><i class="fas fa-book"></i> Subject: <span id="quiz-subject">English Grammar</span></span>
                        <span><i class="fas fa-clock"></i> Per MCQ: <span id="per-mcq-time">1</span> Minute</span>
                    </div>
                </div>
            </div>
            <div class="timer-container">
                <div class="timer" id="question-timer">60</div>
                <div class="timer total-timer" id="timer">40:00</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="quiz-progress"></div>
            </div>

            <div class="question-nav" id="question-nav"></div>
            
            <div class="question-container">
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container"></div>
                <div class="reasoning" id="reasoning">
                    <div class="reasoning-title"><i class="fas fa-lightbulb"></i> Explanation:</div>
                    <div id="reasoning-text"></div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn btn-back" onclick="navigateQuestion('prev')">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-btn btn-next" onclick="navigateQuestion('next')">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="nav-btn btn-reasoning disabled" id="reasoning-btn" onclick="toggleReasoning()">
                    <i class="fas fa-lightbulb"></i> Reasoning
                </button>
                <button class="nav-btn btn-submit" onclick="submitTest()">
                    Submit <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <div id="results-page" class="page">
            <div class="results-header-buttons">
                <a id="website-link" href="#" target="_blank" class="btn btn-primary"><i class="fas fa-globe"></i> Website</a>
                <a id="whatsapp-contact-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> Whatsapp Contact</a>
                <a id="whatsapp-community-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fas fa-users"></i> Whatsapp Community</a>
            </div>
            
            <div class="quick-stats">
                <div class="stat-card correct">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card incorrect">
                    <div class="stat-value" id="incorrect-count">0</div>
                    <div class="stat-label">Incorrect</div>
                </div>
                <div class="stat-card unanswered">
                    <div class="stat-value" id="unanswered-count">0</div>
                    <div class="stat-label">Unanswered</div>
                </div>
            </div>
            
            <div class="performance-meter">
                <div class="performance-fill" id="performance-fill"></div>
            </div>
            
            <div class="result-card">
                <h2><i class="fas fa-user-graduate"></i> Student Information</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Detail</th>
                        </tr>
                    </thead>
                    <tbody id="student-info-table"></tbody>
                </table>
            </div>

            <div class="result-card">
                <h2><i class="fas fa-chart-bar"></i> Test Results</h2>
                <table>
                    <tbody id="quiz-results-table"></tbody>
                </table>
            </div>
            
            <div class="result-actions">
                <button class="btn btn-primary" onclick="restartTest()">
                    <i class="fas fa-redo"></i> Retake Full Test
                </button>
                <button class="btn btn-primary" onclick="retakeIncorrect()">
                    <i class="fas fa-bolt"></i> Retake Incorrect Questions
                </button>
                <button class="btn btn-primary" onclick="viewAllMcqs()">
                    <i class="fas fa-clipboard-list"></i> View All MCQs
                </button>
            </div>
        </div>

        <div id="all-mcqs-page" class="page">
            <h2><i class="fas fa-list-alt"></i> All MCQs and Solutions</h2>
            <div class="all-mcqs-list" id="all-mcqs-list"></div>
            <button class="btn btn-primary" onclick="showPage('results-page')">
                <i class="fas fa-arrow-left"></i> Back to Results
            </button>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html><script>// ***************************************************************
// !! IMPORTANT: GOOGLE APPS SCRIPT URL FOR DATA LOGGING !!
const SHEET_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2N316gzPWvSV7_59Mjx49idXLH8Sc7S_S0nHhvGjYxhhGjTm8UBnsRB4VGgeuluL0/exec';
// ***************************************************************

// Quiz Data
const quizData_WCW_PHY_001 = [
    {
        question: "Q: In physics, when is work fundamentally considered to be done on an object?",
        options: [
            "When a force is applied for an extended duration, regardless of movement.",
            "When a force causes a displacement in the direction of the force.",
            "When an object possesses potential energy due to its position.",
            "When a body maintains a constant velocity under external influence."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that work is done when a force causes a displacement of an object in the direction of the force. If there is no displacement or the force is perpendicular to displacement, no work is done."
    },
    {
        question: "Q: Consider a scenario where a person is pushing against a massive, stationary wall. Despite exerting significant effort, the wall remains unmoved. What is the work done by the person on the wall in this situation?",
        options: [
            "Substantial positive work, as effort is clearly expended.",
            "Negative work, due to the resistance from the wall.",
            "Zero work, because there is no displacement of the wall.",
            "Work that cannot be determined without knowing the force magnitude."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that zero work is done if there is no displacement, regardless of the force applied. Since the wall does not move, no work is done on it."
    },
    {
        question: "Q: An object moves horizontally across a surface. If the gravitational force acts upon this object, what is the work done by gravity on the object during its horizontal motion?",
        options: [
            "Positive work, as gravity is always present.",
            "Negative work, opposing the object's motion.",
            "Zero work, as the gravitational force is perpendicular to the horizontal displacement.",
            "Work that continuously converts potential energy to kinetic energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that if the force is perpendicular to the direction of motion, no work is done by that force. Gravitational force acts vertically downwards, while the motion is horizontal, making them perpendicular."
    },
    {
        question: "Q: If the angle between the force applied to an object and its resulting displacement is 180 degrees, what type of work is being performed by this force?",
        options: [
            "Positive work, enhancing motion.",
            "Zero work, as the forces are in opposition.",
            "Variable work, dependent on the magnitudes involved.",
            "Negative work, reducing the object's kinetic energy."
        ],
        correctAnswer: 3,
        reasoning: "The book theory states that negative work occurs when the force component is opposite to the direction of motion (90° < θ ≤ 180°), slowing the object down and reducing its kinetic energy. An angle of 180 degrees signifies direct opposition."
    },
    {
        question: "Q: A machine is operating with 75% efficiency. What does this percentage primarily indicate about the energy input into the machine?",
        options: [
            "Three-quarters of the input energy is lost as heat.",
            "Three-quarters of the input energy is converted into useful work.",
            "The machine can only perform useful work for 75% of its operational time.",
            "Its power output is 75% of its maximum potential power output."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines efficiency as the ratio of useful work output to total work input. An efficiency of 75% means that 75% of the input energy is successfully transformed into useful work output, while the remaining 25% is lost, typically as heat due to friction."
    },
    {
        question: "Q: When a body's velocity is doubled while its mass remains constant, how does its kinetic energy change?",
        options: [
            "It doubles.",
            "It quadruples.",
            "It halves.",
            "It remains unchanged."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that kinetic energy is possessed by a body due to its motion and is related to its mass and the square of its velocity. If the velocity doubles, the kinetic energy, being dependent on the square of velocity, will increase by a factor of four."
    },
    {
        question: "Q: Which of the following statements best describes the nature of frictional forces?",
        options: [
            "They are conservative forces that conserve mechanical energy.",
            "They are non-conservative forces that dissipate mechanical energy.",
            "They perform positive work to increase an object's speed.",
            "They are responsible for converting potential energy into kinetic energy in ideal systems."
        ],
        correctAnswer: 1,
        reasoning: "The book theory categorizes frictional forces as non-conservative forces. It also states that frictional forces are dissipative, meaning they reduce the mechanical energy of a system, primarily converting it into thermal energy (heat)."
    },
    {
        question: "Q: What is the primary characteristic that distinguishes a conservative force from a non-conservative force?",
        options: [
            "The magnitude of the force remains constant regardless of position.",
            "The force always acts to increase the kinetic energy of an object.",
            "The work done by the force between two points is independent of the path taken.",
            "The force is directly proportional to the displacement it causes."
        ],
        correctAnswer: 2,
        reasoning: "The book theory defines conservative forces as those for which the work done in moving an object between two points is independent of the path taken. This is the defining characteristic."
    },
    {
        question: "Q: A system experiences an increase in kinetic energy. If no external work is done on the system, which of the following must have occurred if mechanical energy is conserved?",
        options: [
            "The object's mass must have increased.",
            "The object's velocity must have decreased.",
            "There must have been an equivalent decrease in the system's potential energy.",
            "The system must have generated energy from an internal source."
        ],
        correctAnswer: 2,
        reasoning: "The book theory on the conservation of energy states that energy cannot be created or destroyed, only transformed. In a frictionless system (where mechanical energy is conserved), kinetic energy gained is equal to potential energy lost. Therefore, an increase in kinetic energy implies an equivalent decrease in potential energy."
    },
    {
        question: "Q: A force-displacement graph displays a curved line. How is the total work done by this variable force typically determined?",
        options: [
            "By calculating the product of the maximum force and total displacement.",
            "By determining the slope of the curve at its peak point.",
            "By calculating the area enclosed under the force-displacement curve.",
            "By measuring the average force and multiplying it by the final displacement."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that work done by a variable force is graphically represented as the area under a force-displacement curve. This method accounts for the changing force over the displacement."
    },
    {
        question: "Q: The Moon revolves around the Earth. Assuming its orbit is perfectly circular, what can be said about the work done by Earth's gravitational force on the Moon?",
        options: [
            "Positive work is continuously done, sustaining its orbit.",
            "The work done is always zero because the gravitational force is perpendicular to the Moon's instantaneous displacement.",
            "Negative work is done, slowing the Moon's orbital speed.",
            "The work done varies, increasing as the Moon approaches Earth and decreasing as it moves away."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that if a force is perpendicular to the direction of motion, no work is done by that force. In a perfectly circular orbit, the gravitational force (directed towards the Earth) is always perpendicular to the Moon's tangential velocity (and thus its instantaneous displacement). Therefore, the work done by gravity is zero."
    },
    {
        question: "Q: When a crane lifts a heavy object vertically upwards at a constant speed, what is the relationship between the work done by the crane's lifting force and the work done by gravity?",
        options: [
            "The crane's work is greater than gravity's work.",
            "The crane's work is equal in magnitude and opposite in sign to gravity's work.",
            "The crane's work is zero, as the speed is constant.",
            "Gravity does no work because the object is moving against it."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines work as force times displacement times the cosine of the angle between them. For constant velocity lifting, the lifting force is equal in magnitude to the gravitational force. The lifting force acts in the direction of displacement (positive work), while gravity acts opposite to the displacement (negative work). Therefore, their magnitudes are equal, but their signs are opposite, resulting in zero net work and no change in kinetic energy for constant speed."
    },
    {
        question: "Q: If a specific amount of mechanical energy is put into an actual machine, why is the useful work output always less than this input?",
        options: [
            "The machine stores some energy for future operation.",
            "Some input energy is invariably lost, primarily as thermal energy due to friction.",
            "The machine inherently alters the form of energy, reducing its total quantity.",
            "The machine can only convert a fraction of the input energy into mechanical output."
        ],
        correctAnswer: 1,
        reasoning: "The book theory explains that in actual machines, efficiency is always less than 100% because some input energy is always lost, primarily as thermal energy (heat) due to friction. Frictional forces are dissipative and reduce the mechanical energy of the system."
    },
    {
        question: "Q: Consider the concept of 'absolute potential energy' as defined in the context of gravitational fields. Why is it typically represented with a negative sign?",
        options: [
            "It signifies that potential energy is always lost when an object moves closer to the field source.",
            "It indicates that potential energy increases (becomes less negative) as the distance from the source increases, moving towards the zero reference at infinity.",
            "It represents the amount of work required to prevent the object from accelerating in the field.",
            "It denotes that the force involved is always attractive, pulling the object inward."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines absolute potential energy as the work done in moving a body from infinity (where potential energy is zero) to a certain point. The negative sign indicates that as distance from the gravitational source increases, potential energy becomes less negative, meaning it increases towards the zero value at infinity. Conversely, as an object moves closer to the source, its potential energy becomes more negative, signifying a deeper 'potential well'."
    },
    {
        question: "Q: An object is dropped from a certain height. Neglecting air resistance, what is the relationship between its potential energy and kinetic energy as it falls?",
        options: [
            "Its potential energy increases while its kinetic energy decreases.",
            "Its potential energy and kinetic energy both decrease proportionally.",
            "Its potential energy converts into an equal amount of kinetic energy.",
            "Its potential energy and kinetic energy remain constant, but their forms change."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states the law of conservation of energy: energy cannot be created or destroyed, only transformed. In a frictionless system (neglecting air resistance), the potential energy lost by a falling body is converted into an equal amount of kinetic energy gained, such that their sum remains constant."
    },
    {
        question: "Q: If the instantaneous power being delivered to an object is known, along with the force being applied, how can the instantaneous velocity of the object be conceptually understood in relation to these quantities?",
        options: [
            "Velocity is the difference between power and force.",
            "Velocity is the ratio of power to force, considering their alignment.",
            "Velocity is the product of power and force.",
            "Velocity is unrelated to instantaneous power and force without knowing the mass."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines instantaneous power as the dot product of force and velocity. Conceptually, this means power is the rate at which work is done, which can also be expressed as the component of force in the direction of motion multiplied by the object's speed. Therefore, velocity can be understood as derived from the power output divided by the effective force component."
    },
    {
        question: "Q: When an object's kinetic energy increases, which of the following must be true about the net work done on it by external forces?",
        options: [
            "Net work done must be negative.",
            "Net work done must be zero.",
            "Net work done must be positive.",
            "Net work done must be equal to the initial potential energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory implies through the work-energy theorem (though not explicitly stated with equations) that an increase in kinetic energy corresponds to positive net work done on the object. Positive work increases kinetic energy."
    },
    {
        question: "Q: Which of the following physical quantities represents the rate at which work is done or energy is transferred?",
        options: [
            "Work",
            "Energy",
            "Power",
            "Efficiency"
        ],
        correctAnswer: 2,
        reasoning: "The book theory explicitly defines power as the rate at which work is done or the rate of transfer of energy."
    },
    {
        question: "Q: In an ideal machine, where no energy is lost, what would be its percentage efficiency?",
        options: [
            "Less than 100%",
            "Exactly 100%",
            "Greater than 100%",
            "Dependent on the type of machine"
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that an ideal machine would be 100% efficient, meaning no energy is lost. Actual machines always have efficiency less than 100%."
    },
    {
        question: "Q: The gravitational potential energy of an object at a certain height above the ground is dependent on which three factors?",
        options: [
            "Its mass, its velocity, and the acceleration due to gravity.",
            "Its mass, the height, and the acceleration due to gravity.",
            "Its volume, its density, and the height.",
            "Its kinetic energy, its power, and its mass."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that gravitational potential energy is defined by the object's mass, the acceleration due to gravity, and its height. These three factors combine to determine the stored energy due to position."
    },
    {
        question: "Q: If a force is applied to an object, but the object experiences no displacement, what is the consequence for the energy state of the object directly due to this force?",
        options: [
            "Its kinetic energy increases.",
            "Its potential energy increases.",
            "There is no change in its mechanical energy due to this force.",
            "It loses energy due to internal work."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that if an object does not move (no displacement), no work is done. Since work is the transfer of energy, if no work is done, there is no change in the mechanical energy (kinetic or potential) of the object due to that specific force."
    },
    {
        question: "Q: What is the significance of the Joule (J) as the SI unit of work?",
        options: [
            "It represents the work done by one Newton of force over one centimeter of displacement.",
            "It represents the energy expended by one Watt of power for one second.",
            "It represents the work done by one Newton of force over one meter of displacement.",
            "It signifies the potential energy of one kilogram at one meter height."
        ],
        correctAnswer: 2,
        reasoning: "The book theory explicitly defines the SI unit of work, the Joule (J), as equal to 1 Newton-meter (1 N·m). This means one Joule of work is done when a force of one Newton causes a displacement of one meter."
    },
    {
        question: "Q: A car is braking, and its speed is decreasing. What can be said about the work done by the braking force on the car?",
        options: [
            "It is positive work, as it facilitates a change in motion.",
            "It is zero work, if the car eventually stops.",
            "It is negative work, as it opposes the direction of motion and reduces kinetic energy.",
            "It is directly proportional to the car's initial speed."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that negative work occurs when the force component is opposite to the direction of motion, slowing the object down and reducing its kinetic energy. Braking force acts opposite to the car's motion, performing negative work and reducing its speed."
    },
    {
        question: "Q: How does the commercial unit of electrical energy, the kilowatt-hour (kWh), conceptually relate to the fundamental SI unit of energy, the Joule (J)?",
        options: [
            "A kilowatt-hour is a smaller unit, primarily used for very low power consumption.",
            "A kilowatt-hour is a unit of power multiplied by time, representing a large amount of energy.",
            "A kilowatt-hour is fundamentally a unit of power, not energy.",
            "A kilowatt-hour represents a specific rate of energy consumption."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines kilowatt-hour (kWh) as a commercial unit of work/electrical energy, stating its conversion to Joules. Since power is the rate of doing work (work/time), power multiplied by time yields work or energy. Thus, a kilowatt-hour (kilowatt × hour) represents a substantial amount of energy, specifically 3.6 × 10⁶ Joules."
    },
    {
        question: "Q: Consider two objects of different masses moving with the same velocity. If both are brought to rest by an identical constant opposing force, which object requires more work to be stopped?",
        options: [
            "The object with less mass, as it decelerates faster.",
            "The object with greater mass, as it possesses more kinetic energy.",
            "Both require the same amount of work, as they have the same initial velocity.",
            "The work required cannot be compared without knowing the stopping distance."
        ],
        correctAnswer: 1,
        reasoning: "The book theory implies that the work done to stop an object is equal to its initial kinetic energy (work-energy theorem). Since kinetic energy depends on both mass and the square of velocity, the object with greater mass, moving at the same velocity, will possess more kinetic energy and thus require more negative work to be stopped."
    },
    {
        question: "Q: A ball is thrown upwards. Ignoring air resistance, at its highest point, what is the nature of its kinetic and potential energy?",
        options: [
            "Both kinetic and potential energy are at their maximum values.",
            "Kinetic energy is zero, and potential energy is at its maximum.",
            "Potential energy is zero, and kinetic energy is at its maximum.",
            "Both kinetic and potential energy are zero."
        ],
        correctAnswer: 1,
        reasoning: "The book theory of energy transformation states that as an object rises, its kinetic energy converts into potential energy. At the highest point of its trajectory (ignoring air resistance), the ball momentarily stops, meaning its velocity is zero, and thus its kinetic energy is zero. At this point, all its initial kinetic energy has been converted into gravitational potential energy, making its potential energy maximum."
    },
    {
        question: "Q: If a simple machine's efficiency is 60%, and a certain amount of work is inputted, what percentage of the input energy is considered 'lost' or converted into unusable forms?",
        options: [
            "60%",
            "40%",
            "100%",
            "Cannot be determined without the total input work."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines efficiency as the ratio of useful output work to total input work. If efficiency is 60%, it means 60% of the input work is useful output. The remaining percentage, (100% - 60%) = 40%, represents the energy lost, primarily as heat due to friction, and converted into unusable forms."
    },
    {
        question: "Q: Which of the following forces is categorized as a conservative force?",
        options: [
            "Frictional force",
            "Air resistance",
            "Gravitational force",
            "Tension in a string"
        ],
        correctAnswer: 2,
        reasoning: "The book theory explicitly lists gravitational force as an example of a conservative force, alongside electric force and elastic spring force."
    },
    {
        question: "Q: A car is accelerating uniformly. If its engine continuously provides a constant force, how does the engine's power output change over time?",
        options: [
            "It remains constant, as the force is constant.",
            "It decreases, as the work done per unit time diminishes.",
            "It increases, as the car's velocity increases.",
            "It varies sinusoidally with time."
        ],
        correctAnswer: 2,
        reasoning: "The book theory defines power in terms of force and velocity. If the engine provides a constant force and the car is accelerating, its velocity is continuously increasing. Therefore, the power output of the engine, being related to the product of force and velocity, must continuously increase."
    },
    {
        question: "Q: In the work-energy equation considering friction, what is the relationship between the loss in potential energy, the gain in kinetic energy, and the work done against friction?",
        options: [
            "Loss in potential energy equals gain in kinetic energy.",
            "Loss in potential energy equals work done against friction minus gain in kinetic energy.",
            "Loss in potential energy equals gain in kinetic energy plus work done against friction.",
            "Gain in kinetic energy equals loss in potential energy plus work done against friction."
        ],
        correctAnswer: 2,
        reasoning: "The book theory explicitly states the work-energy equation with friction: Loss in potential energy = gain in kinetic energy + work done against friction. This accounts for energy dissipation."
    },
    {
        question: "Q: A person holds a heavy chair motionless above the ground. What is the work done by the person on the chair in this specific scenario?",
        options: [
            "Positive work, as effort is clearly being exerted.",
            "Negative work, due to opposing gravity.",
            "Zero work, because there is no displacement of the chair.",
            "Work equal to the chair's potential energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that zero work is done if there is no displacement. Since the chair is held motionless, its displacement is zero, and thus no work is done by the person on the chair in this instance, despite the exertion."
    },
    {
        question: "Q: If a conservative force acts on an object, and the object completes a closed path, returning to its starting point, what is the total work done by this force during the entire journey?",
        options: [
            "It is always positive, increasing the object's speed.",
            "It depends on the speed of the object.",
            "It is always zero.",
            "It is equal to the change in the object's kinetic energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states a key characteristic of a conservative force: the work done by a conservative force in a closed path is zero. This is a direct consequence of the work done being independent of the path taken."
    },
    {
        question: "Q: An object is moved from a very distant point (considered infinity) to a certain location within a gravitational field without acceleration. What does the work required for this action represent?",
        options: [
            "The object's kinetic energy at that point.",
            "The change in the object's gravitational potential energy relative to its initial state.",
            "The absolute potential energy of the object at that location.",
            "The total mechanical energy of the object in the field."
        ],
        correctAnswer: 2,
        reasoning: "The book theory defines absolute potential energy as the amount of work done in moving a body from infinity (where potential energy is considered zero) to a certain point in a gravitational field, such that the body is never accelerated. This definition directly matches the scenario."
    },
    {
        question: "Q: How do dissipative forces fundamentally affect the total mechanical energy of a system?",
        options: [
            "They increase it by converting other forms of energy into mechanical energy.",
            "They conserve it by transforming kinetic energy into potential energy.",
            "They reduce it by converting mechanical energy into unusable forms like heat.",
            "They have no effect on total mechanical energy, only on its distribution."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that frictional forces are called dissipative forces because they reduce the mechanical energy of a system, primarily converting it into thermal energy (heat). This loss means mechanical energy is not conserved when dissipative forces are present."
    },
    {
        question: "Q: If a body possesses potential energy due to its position, and this potential energy transforms into kinetic energy without any loss, what happens to the body's speed?",
        options: [
            "Its speed decreases proportionally to the potential energy loss.",
            "Its speed increases, related to the square root of the potential energy loss.",
            "Its speed remains constant, as energy is merely transformed.",
            "Its speed changes based on the mass of the body only."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that kinetic energy is related to mass and the square of velocity. If potential energy transforms into kinetic energy without loss, the kinetic energy increases. An increase in kinetic energy, with constant mass, implies an increase in velocity. Specifically, since kinetic energy is related to the square of velocity, velocity is related to the square root of kinetic energy, and thus to the square root of the potential energy loss."
    },
    {
        question: "Q: When comparing the work done by a constant force versus a variable force over the same displacement, under what condition could the work done by the variable force be exactly the same as the constant force?",
        options: [
            "Only if the variable force consistently acts perpendicular to displacement.",
            "If the average magnitude of the variable force over the displacement is equal to the constant force, assuming identical angles.",
            "Never, as variable forces inherently do different types of work.",
            "Only if the variable force is always zero."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines work by a constant force as Fdcosθ and work by a variable force as the area under the Fx vs. Δd curve. Conceptually, if the area under the variable force-displacement curve is equal to the rectangle formed by the constant force and displacement (assuming the same alignment or angle with displacement), then the work done would be the same. This implies the average value of the variable force effectively matches the constant force over that distance."
    },
    {
        question: "Q: A satellite orbits a planet in an elliptical path. In this scenario, what can be inferred about the work done by the planet's gravitational force on the satellite?",
        options: [
            "It is always zero, as gravity is perpendicular to instantaneous motion.",
            "It is always positive, increasing the satellite's speed.",
            "It varies, being positive when the satellite approaches the planet and negative when it moves away.",
            "It is always negative, continuously slowing the satellite down."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that positive work occurs when the force component is in the direction of motion, and negative work when opposite. In an elliptical orbit, the gravitational force (a conservative force) is not always perpendicular to the displacement. When the satellite approaches the planet, gravity has a component in the direction of motion, doing positive work and increasing kinetic energy. When moving away, gravity has a component opposite to motion, doing negative work and decreasing kinetic energy. Over a closed elliptical path, the net work done by gravity is still zero because it is a conservative force, but instantaneously it performs both positive and negative work."
    },
    {
        question: "Q: Consider two objects, A and B. Object A has twice the mass of Object B, but Object B is moving at twice the velocity of Object A. Which object possesses greater kinetic energy?",
        options: [
            "Object A, due to its larger mass.",
            "Object B, due to its significantly higher velocity.",
            "Both objects have the same kinetic energy.",
            "It cannot be determined without specific numerical values."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that kinetic energy depends on mass and the square of velocity. If Object A has mass '2m' and velocity 'v', its kinetic energy is related to 2m * v^2. If Object B has mass 'm' and velocity '2v', its kinetic energy is related to m * (2v)^2 = m * 4v^2 = 4mv^2. Therefore, Object B has greater kinetic energy (twice that of Object A)."
    },
    {
        question: "Q: If a device converts 1000 Joules of input energy into 700 Joules of useful output work, how would its efficiency be characterized?",
        options: [
            "It is highly inefficient, losing most of its energy.",
            "It has a reasonable efficiency, but not ideal.",
            "It is nearly perfectly efficient, close to 100%.",
            "Its efficiency cannot be quantified without knowing the power output."
        ],
        correctAnswer: 1,
        reasoning: "The book theory defines efficiency as (Output Work / Input Work) × 100%. Here, (700 J / 1000 J) × 100% = 70%. This represents a reasonable efficiency for an actual machine, but certainly not ideal (100%) nor 'highly inefficient' in a general sense, suggesting it falls into the category of 'reasonable, but not ideal'."
    },
    {
        question: "Q: A person pushes a heavy box across a rough floor at a constant velocity. What is the net work done on the box by all forces combined?",
        options: [
            "Positive work, because the box is moving.",
            "Negative work, due to friction.",
            "Zero work, as there is no change in kinetic energy.",
            "Work equal to the work done by the pushing force."
        ],
        correctAnswer: 2,
        reasoning: "The book theory implies (via the work-energy theorem) that if an object moves at a constant velocity, its kinetic energy does not change. Therefore, the net work done on the object by all forces combined must be zero. The pushing force does positive work, and friction does negative work, but they are equal in magnitude and opposite in sign, resulting in zero net work."
    },
    {
        question: "Q: Why is the process of energy transformation never perfectly 100% efficient in practical devices?",
        options: [
            "Because matter is always lost during energy conversion.",
            "Because some input energy is always lost, primarily as thermal energy due to friction.",
            "Because the total energy in the universe is constantly decreasing.",
            "Because the output energy invariably exceeds the input energy in real systems."
        ],
        correctAnswer: 1,
        reasoning: "The book theory explicitly states that efficiency is always less than 100% in actual machines because some input energy is always lost, primarily as thermal energy (heat) due to friction. Frictional forces are dissipative and reduce the mechanical energy available for useful work."
    },
    {
        question: "Q: If an object's mass is halved, and its velocity is simultaneously doubled, how does its kinetic energy change?",
        options: [
            "It remains unchanged.",
            "It doubles.",
            "It halves.",
            "It quadruples."
        ],
        correctAnswer: 1,
        reasoning: "The book theory states that kinetic energy depends on mass and the square of velocity. If mass is 'm' and velocity 'v', KE is related to mv². If mass becomes m/2 and velocity becomes 2v, the new kinetic energy is related to (m/2) * (2v)² = (m/2) * 4v² = 2mv². Therefore, the kinetic energy doubles."
    },
    {
        question: "Q: What is the primary reason that electric forces are considered conservative forces?",
        options: [
            "They always cause acceleration in charged particles.",
            "They act over infinite distances without diminishing.",
            "The work they do on a charged particle moving between two points is independent of the path taken.",
            "They cannot convert potential energy into kinetic energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory lists electric force as an example of a conservative force. The defining characteristic of conservative forces is that the work done by them in moving an object between two points is independent of the path taken, which applies to electric forces."
    },
    {
        question: "Q: An elevator cable exerts an upward force on an elevator cabin moving downwards at a constant speed. What type of work is done by the cable on the cabin?",
        options: [
            "Positive work, as the cable is exerting tension.",
            "Zero work, as the speed is constant.",
            "Negative work, because the force is opposite to the displacement.",
            "Work that adds to the cabin's kinetic energy."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that negative work occurs when the force component is opposite to the direction of motion. Here, the cable exerts an upward force, but the elevator is moving downwards. Since the force and displacement are in opposite directions, the cable performs negative work on the cabin."
    },
    {
        question: "Q: Consider an object moving in a fluid, experiencing air resistance. If this object is moving along a complicated, winding path between two points, how would the work done by the air resistance compare to the work done if it moved along a straight path between the same two points?",
        options: [
            "The work done by air resistance would be the same for both paths.",
            "The work done by air resistance would be greater for the winding path.",
            "The work done by air resistance would be less for the winding path.",
            "Air resistance does no work, as it is a non-conservative force."
        ],
        correctAnswer: 1,
        reasoning: "The book theory categorizes air resistance as a non-conservative force, for which the work done in moving an object between two points does depend on the path taken. A winding path implies a longer travel distance through the resistive medium compared to a straight path between the same two points. Since air resistance opposes motion along the path, more work would be done against it (i.e., more negative work would be done by it) over the longer, winding path."
    },
    {
        question: "Q: If the total mechanical energy of a system is observed to decrease, but no external non-conservative forces like friction are identified, what does this imply about other forms of energy within the system?",
        options: [
            "Other forms of energy must have increased, maintaining overall energy conservation.",
            "The system is not closed, and energy has left it without transformation.",
            "The law of conservation of energy has been momentarily violated.",
            "The potential energy of the system has increased dramatically."
        ],
        correctAnswer: 0,
        reasoning: "The book theory of conservation of energy states that energy cannot be created or destroyed, only transformed. If mechanical energy (kinetic + potential) decreases, and no external non-conservative forces are identified as dissipating it as heat, it implies that the mechanical energy must have transformed into some other form of energy within the system that is not typically classified as mechanical (e.g., internal energy, sound, light), thus maintaining overall energy conservation."
    },
    {
        question: "Q: An engineer aims to design a machine with 100% efficiency. What fundamental physical principle prevents the creation of such a machine in practice?",
        options: [
            "The principle that energy can only exist in two forms.",
            "The universal law that mass is always lost in energy conversion.",
            "The inherent presence of dissipative forces like friction, causing energy loss as heat.",
            "The constraint that no machine can operate at maximum power indefinitely."
        ],
        correctAnswer: 2,
        reasoning: "The book theory explains that an actual machine always has an efficiency less than 100% because some input energy is always transformed into unusable forms, mainly heat due to friction. This inherent presence of dissipative forces and the resulting energy losses are the fundamental reasons preventing 100% efficiency in practical machines."
    },
    {
        question: "Q: A person runs up a flight of stairs. Which of the following statements accurately describes the work done by gravity on the person?",
        options: [
            "It is positive work, as the person is moving.",
            "It is zero work, because gravity acts downwards.",
            "It is negative work, as gravity opposes the upward displacement.",
            "It is equal in magnitude to the work done by the person."
        ],
        correctAnswer: 2,
        reasoning: "The book theory states that negative work occurs when the force component is opposite to the direction of motion. As the person moves upwards, gravity acts downwards, thus performing negative work on the person. This negative work reduces the person's kinetic energy or requires the person to do more positive work to ascend."
    },
    {
        question: "Q: What is the primary reason that petrol engines typically have low efficiencies compared to modern electrical devices like LEDs?",
        options: [
            "Petrol engines generate significantly more power.",
            "Petrol engines involve substantial energy losses, primarily as heat and sound, due to combustion and mechanical friction.",
            "LEDs consume less energy, making them appear more efficient.",
            "The energy transformation in petrol engines is simpler than in LEDs."
        ],
        correctAnswer: 1,
        reasoning: "The book theory discusses energy losses in practical devices, mainly due to friction and conversion to thermal energy (heat). Petrol engines are explicitly mentioned as examples where such losses occur significantly during combustion and mechanical processes, leading to lower efficiency compared to devices like LEDs that convert electrical energy to light more directly and with less waste heat."
    },
    {
        question: "Q: If a spring is compressed, it stores elastic potential energy. When this spring expands and pushes an object, converting its stored energy into the object's kinetic energy, what type of force is the spring force considered to be?",
        options: [
            "A non-conservative force, because it causes motion.",
            "A dissipative force, as it releases energy.",
            "A conservative force, as the work it does depends only on the initial and final states of compression/extension.",
            "A propulsion force, as it initiates movement."
        ],
        correctAnswer: 2,
        reasoning: "The book theory explicitly lists elastic spring force as an example of a conservative force. The work done by an ideal spring force depends only on the change in its compression or extension, not on the path taken to achieve that change."
    }
];

// Constants
const QUIZ_ACCESS_CODE = "PreMium-A-12345";
const DEV_ACCESS_CODE = "Dev-PDA-001";
const ACADEMY_NAME = "WHITE COAT WORRIORS ";
const QUIZ_SUBJECT = "Physics ";
const WEBSITE_LINK = "https://premiumdoctoracademy.com";
const WHATSAPP_CONTACT = "03287743851";
const WHATSAPP_COMMUNITY = "https://whatsapp.com/channel/0029VaFCIU6EquiOlXWcNR1X";
const TIME_PER_MCQ = 60;
const MARK_PER_MCQ = 1;
const NEGATIVE_MARKING = 0;

// Global state variables
let currentQuizId = 'WCW-PHY-001';
let quizData = quizData_WCW_PHY_001;
let currentQuestion = 0;
let userAnswers = Array(quizData.length).fill(null);
let timeLeft;
let questionTimeLeft;
let totalTimeInterval;
let questionTimeInterval;
let studentData = {};
let studentAccessCode = "";

// DOM elements
const questionNavEl = document.getElementById('question-nav');
const questionTextEl = document.getElementById('question-text');
const optionsContainerEl = document.getElementById('options-container');
const reasoningEl = document.getElementById('reasoning');
const reasoningTextEl = document.getElementById('reasoning-text');
const quizTitleEl = document.getElementById('quiz-title');
const quizSubjectEl = document.getElementById('quiz-subject');
const perMcqTimeEl = document.getElementById('per-mcq-time');
const totalTimerEl = document.getElementById('timer');
const questionTimerEl = document.getElementById('question-timer');
const quizProgressEl = document.getElementById('quiz-progress');
const studentInfoTable = document.getElementById('student-info-table');
const quizResultsTable = document.getElementById('quiz-results-table');
const allMcqsList = document.getElementById('all-mcqs-list');
const devPasswordInput = document.getElementById('developerPassword');
const devErrorBox = document.getElementById('dev-error-box');
const quizAccessCodeInput = document.getElementById('quizAccessCode');
const quizAccessErrorBox = document.getElementById('quiz-error-box');
const toggleDevPasswordIcon = document.getElementById('toggleDeveloperPassword');
const toggleQuizCodeIcon = document.getElementById('toggleQuizAccessCode');
const websiteLinkEl = document.getElementById('website-link');
const whatsappContactLinkEl = document.getElementById('whatsapp-contact-link');
const whatsappCommunityLinkEl = document.getElementById('whatsapp-community-link');
const reasoningBtn = document.getElementById('reasoning-btn');
const quizNotificationEl = document.getElementById('quiz-notification');
const notificationTitleEl = document.getElementById('notification-title');
const notificationMessageEl = document.getElementById('notification-message');
const notificationYesBtn = document.getElementById('notification-yes');
const notificationNoBtn = document.getElementById('notification-no');
const correctCountEl = document.getElementById('correct-count');
const incorrectCountEl = document.getElementById('incorrect-count');
const unansweredCountEl = document.getElementById('unanswered-count');
const performanceFillEl = document.getElementById('performance-fill');


/**
 * @description Sends data to the Google Apps Script endpoint.
 * @param {object} data - The payload containing type ('registration' or 'quiz_result') and data.
 */
function sendDataToSheet(data) {
    if (!SHEET_SCRIPT_URL || SHEET_SCRIPT_URL.includes('YOUR_DEPLOYED_WEB_APP_URL')) {
        console.error('SHEET_SCRIPT_URL is not configured. Data not sent to Google Sheet.');
        return Promise.resolve({ success: false, message: 'Script URL not configured.' });
    }

    return fetch(SHEET_SCRIPT_URL, {
        method: 'POST',
        // 'no-cors' is necessary for Apps Script to accept cross-origin POST requests from a web page
        mode: 'no-cors',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        // Cannot read response body with 'no-cors', assume request was sent successfully
        return { success: true, message: 'Request sent to Google Script.' };
    })
    .catch(error => {
        console.error('Sheet Data Send Error:', error);
        return { success: false, message: 'Failed to send request to Google Script.' };
    });
}


// Initialization
document.addEventListener('DOMContentLoaded', () => {
    const storedStudentData = localStorage.getItem('studentData');
    if (storedStudentData) {
        studentData = JSON.parse(storedStudentData);
        document.getElementById('studentName').value = studentData['Student Name'] || '';
        document.getElementById('fatherName').value = studentData['Father Name'] || '';
        document.getElementById('email').value = studentData['Email'] || '';
        document.getElementById('mobile').value = studentData['Mobile'] || '';
        document.getElementById('city').value = studentData['City'] || '';
    }
    const storedCode = localStorage.getItem('studentAccessCode');
    if (storedCode) {
        studentAccessCode = storedCode;
    }
    
    showPage('signin-page');
    
    if (toggleDevPasswordIcon) toggleDevPasswordIcon.addEventListener('click', () => togglePasswordVisibility('developerPassword', 'toggleDeveloperPassword'));
    if (toggleQuizCodeIcon) toggleQuizCodeIcon.addEventListener('click', () => togglePasswordVisibility('quizAccessCode', 'toggleQuizAccessCode'));
});

function showQuizNotification(title, message, type = 'info') {
    const allowedNotifications = ['Registration Successful', 'Access Granted', 
                                 'Quiz Completed!', 'Quiz Reset', 'Registration Error', 'Submission Error', 'Registration Warning'];
    
    if (!allowedNotifications.includes(title)) {
        return;
    }
    
    notificationTitleEl.textContent = title;
    notificationMessageEl.textContent = message;
    
    quizNotificationEl.classList.remove('warning', 'error');
    
    if (type === 'warning') {
        quizNotificationEl.classList.add('warning');
    } else if (type === 'error') {
        quizNotificationEl.classList.add('error');
    }
    
    quizNotificationEl.classList.add('show');
    
    setTimeout(() => {
        if (quizNotificationEl.classList.contains('show')) {
            hideQuizNotification();
        }
    }, 5000);
}

function hideQuizNotification() {
    quizNotificationEl.classList.remove('show');
}

function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.error-box, .success-box').forEach(el => el.style.display = 'none');
}

function togglePasswordVisibility(inputID, iconID) {
    const passwordInput = document.getElementById(inputID);
    const toggleIcon = document.getElementById(iconID);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    }
}

function showQuizAccessForm() {
    document.getElementById('quiz-access-form').style.display = 'flex';
    document.getElementById('developer-access-form').style.display = 'none';
}

function showDeveloperAccessForm() {
    document.getElementById('developer-access-form').style.display = 'flex';
    document.getElementById('quiz-access-form').style.display = 'none';
}

function showRegistrationPage() {
    showPage('registration-page');
}

// Registration Handler
function generateAccessCode(studentName, fatherName) {
    const studentInitials = studentName.split(' ').map(n => n[0]).join('').toUpperCase();
    const fatherInitials = fatherName.split(' ').map(n => n[0]).join('').toUpperCase();
    const uniqueId = Math.random().toString(36).substring(2, 7).toUpperCase();

    return `${ACADEMY_NAME.replace(/\s+/g, '-')}-${studentInitials}${fatherInitials}-${uniqueId}`;
}

function handleRegistration() {
    const sName = document.getElementById('studentName').value.trim();
    const fName = document.getElementById('fatherName').value.trim();
    const email = document.getElementById('email').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    const city = document.getElementById('city').value.trim();
    
    if (!sName || !fName || !email || !mobile || !city) {
        showQuizNotification('Registration Error', 'Please fill in all the registration details.', 'error');
        return;
    }
    
    // Generate access code
    const generatedCode = generateAccessCode(sName, fName);
    studentAccessCode = generatedCode;

    studentData = {
        'Student Name': sName,
        'Father Name': fName,
        'Email': email,
        'Mobile': mobile,
        'City': city
    };

    // --- NEW: SEND REGISTRATION DATA TO GOOGLE SHEET ---
    const registrationDataToSend = {
        type: 'registration',
        accessCode: generatedCode,
        studentName: sName,
        fatherName: fName,
        email: email,
        mobile: mobile,
        city: city
    };
    
    sendDataToSheet(registrationDataToSend)
        .then(response => {
            console.log('Sheet Registration Response:', response);
            showQuizNotification('Registration Successful', `Your code: ${generatedCode}. Data submitted to sheet.`, 'info');
        })
        .catch(error => {
            console.error('Sheet Registration Error:', error);
            showQuizNotification('Registration Warning', `Registration saved locally, but sheet submission failed.`, 'warning');
        });
    // ----------------------------------------------------
    
    // Store data locally
    localStorage.setItem('studentAccessCode', generatedCode);
    localStorage.setItem('studentData', JSON.stringify(studentData));
    
    const registrations = JSON.parse(localStorage.getItem('wcwRegistrations') || '[]');
    registrations.push({
        ...studentData,
        accessCode: generatedCode,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwRegistrations', JSON.stringify(registrations));
    
    
    // Start the quiz after registration
    startQuiz('WCW-PHY-001', 'Student', generatedCode);
}

// Quiz Access Handler
function checkDeveloperPassword() {
    devErrorBox.style.display = 'none';
    if (devPasswordInput.value === DEV_ACCESS_CODE) {
        showQuizNotification('Access Granted', 'Welcome! You have successfully logged in as a developer.', 'info');
        startQuiz('WCW-PHY-001', 'Developer', DEV_ACCESS_CODE);
    } else {
        devErrorBox.style.display = 'block';
    }
}

function accessQuiz(inputCode) {
    const errorBox = document.getElementById('quiz-error-box');
    errorBox.style.display = 'none';
    
    const storedStudentCode = localStorage.getItem('studentAccessCode');
    
    if (inputCode === QUIZ_ACCESS_CODE || inputCode === DEV_ACCESS_CODE || inputCode === storedStudentCode) {
        showQuizNotification('Access Granted', 'Welcome! You can now start the quiz.', 'info');
        startQuiz('WCW-PHY-001', 'Student', inputCode);
    } else {
        errorBox.style.display = 'block';
    }
}

function startQuiz(quizId, userType, code) {
    currentQuizId = quizId;
    quizData = quizData_WCW_PHY_001;
    
    // Always start fresh - no progress restoration
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    
    timeLeft = quizData.length * TIME_PER_MCQ;
    questionTimeLeft = TIME_PER_MCQ;
    
    localStorage.setItem('lastAccessCode', code);

    showPage('quiz-page');
    initQuiz();
}

// Quiz Logic
function initQuiz() {
    quizSubjectEl.textContent = QUIZ_SUBJECT;
    perMcqTimeEl.textContent = Math.floor(TIME_PER_MCQ / 60);
    
    websiteLinkEl.href = WEBSITE_LINK;
    whatsappContactLinkEl.href = 'https://wa.me/' + WHATSAPP_CONTACT;
    whatsappCommunityLinkEl.href = WHATSAPP_COMMUNITY;
    
    quizTitleEl.textContent = `Test - ID: ${currentQuizId}`;
    renderQuestionNav();
    renderQuestion();

    if (totalTimeInterval) clearInterval(totalTimeInterval);
    if (questionTimeInterval) clearInterval(questionTimeInterval);
    
    totalTimeInterval = setInterval(updateTotalTimer, 1000);
    questionTimeInterval = setInterval(updateQuestionTimer, 1000);
}

function updateTotalTimer() {
    if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        totalTimerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
        clearInterval(totalTimeInterval);
        submitTest(true);
    }
}

function updateQuestionTimer() {
    if (questionTimeLeft > 0) {
        questionTimeLeft--;
        questionTimerEl.textContent = `${questionTimeLeft}`;
    } else {
        questionTimeLeft = TIME_PER_MCQ;
        navigateQuestion('next');
    }
}

function renderQuestionNav() {
    questionNavEl.innerHTML = '';
    quizData.forEach((_, index) => {
        const navItem = document.createElement('div');
        navItem.classList.add('question-nav-item');
        navItem.textContent = index + 1;
        navItem.onclick = () => navigateQuestion(index);
        
        if (index === currentQuestion) {
            navItem.classList.add('current');
        } else if (userAnswers[index] !== null) {
            navItem.classList.add('solved');
        } else if (userAnswers.slice(0, index).some(ans => ans !== null) || index < currentQuestion) {
             navItem.classList.add('visited');
        }
        
        questionNavEl.appendChild(navItem);
    });
    updateProgressBar();
}

function updateProgressBar() {
    const solvedCount = userAnswers.filter(answer => answer !== null).length;
    const progress = (solvedCount / quizData.length) * 100;
    quizProgressEl.style.width = `${progress}%`;
}

function renderQuestion() {
    reasoningEl.style.display = 'none';
    reasoningBtn.classList.add('disabled');
    const question = quizData[currentQuestion];
    questionTextEl.textContent = `${currentQuestion + 1}. ${question.question}`;
    
    optionsContainerEl.innerHTML = '';
    question.options.forEach((option, index) => {
        const optionEl = document.createElement('div');
        optionEl.classList.add('option');
        optionEl.textContent = option;
        
        const isAnswered = userAnswers[currentQuestion] !== null;

        if (!isAnswered) {
            optionEl.onclick = () => selectOption(index);
        } else {
            if (index === question.correctAnswer) {
                optionEl.classList.add('correct');
            } else if (index === userAnswers[currentQuestion]) {
                optionEl.classList.add('incorrect');
            }
        }
        
        if (userAnswers[currentQuestion] === index) {
            optionEl.classList.add('selected');
        }

        optionsContainerEl.appendChild(optionEl);
    });
    
    questionTimeLeft = TIME_PER_MCQ;
    questionTimerEl.textContent = `${questionTimeLeft}`;
    renderQuestionNav();
    
    if (userAnswers[currentQuestion] !== null) {
        reasoningBtn.classList.remove('disabled');
    }
}

function selectOption(optionIndex) {
    const question = quizData[currentQuestion];
    userAnswers[currentQuestion] = optionIndex;
    
    reasoningBtn.classList.remove('disabled');
    
    const options = optionsContainerEl.querySelectorAll('.option');
    options.forEach((option, index) => {
        option.onclick = null;
        option.classList.remove('selected', 'correct', 'incorrect');
        
        if (index === question.correctAnswer) {
            option.classList.add('correct');
        } else if (index === optionIndex) {
            option.classList.add('incorrect');
        }
        
        if (index === optionIndex) {
             option.classList.add('selected');
        }
    });

    renderQuestionNav();
    
    setTimeout(() => {
        navigateQuestion('next');
    }, 800);
}

function navigateQuestion(direction) {
    const totalQuestions = quizData.length;
    let nextIndex;

    if (typeof direction === 'number') {
        nextIndex = direction;
    } else if (direction === 'next') {
        nextIndex = (currentQuestion + 1) % totalQuestions;
    } else if (direction === 'prev') {
        nextIndex = (currentQuestion - 1 + totalQuestions) % totalQuestions;
    } else {
        return;
    }

    if (nextIndex === currentQuestion) return;
    
    currentQuestion = nextIndex;
    renderQuestion();
}

function toggleReasoning() {
    if (reasoningBtn.classList.contains('disabled')) return;
    
    const question = quizData[currentQuestion];
    if (reasoningEl.style.display === 'block') {
        reasoningEl.style.display = 'none';
    } else {
        reasoningTextEl.textContent = question.reasoning;
        reasoningEl.style.display = 'block';
    }
}

function submitTest(isTimeout = false) {
    if (!isTimeout && !confirm('Are you sure you want to submit the quiz?')) {
        return;
    }
    
    clearInterval(totalTimeInterval);
    clearInterval(questionTimeInterval);

    let correct = 0;
    let incorrect = 0;
    let unanswered = 0;

    quizData.forEach((question, index) => {
        if (userAnswers[index] === null) {
            unanswered++;
        } else if (userAnswers[index] === question.correctAnswer) {
            correct++;
        } else {
            incorrect++;
        }
    });

    const totalQuestions = quizData.length;
    const totalScore = (correct * MARK_PER_MCQ) - (incorrect * NEGATIVE_MARKING);
    const totalMarks = totalQuestions * MARK_PER_MCQ;

    correctCountEl.textContent = correct;
    incorrectCountEl.textContent = incorrect;
    unansweredCountEl.textContent = unanswered;
    
    const performancePercentage = (correct / totalQuestions) * 100;
    performanceFillEl.style.width = `${performancePercentage}%`;

    const savedStudentData = JSON.parse(localStorage.getItem('studentData') || '{}');
    const lastAccessCode = localStorage.getItem('lastAccessCode') || 'N/A';
    
    let studentInfoHtml = '';
    for (const [key, value] of Object.entries(savedStudentData)) {
        studentInfoHtml += `<tr><td>${key}</td><td>${value}</td></tr>`;
    }
    studentInfoHtml += `<tr><td>Access Code Used</td><td>${lastAccessCode}</td></tr>`;
    studentInfoTable.innerHTML = studentInfoHtml;

    quizResultsTable.innerHTML = `
        <tr><td>Quiz ID</td><td>${currentQuizId}</td></tr>
        <tr><td>Total Questions</td><td>${totalQuestions}</td></tr>
        <tr><td>Correct Answers</td><td>${correct}</td></tr>
        <tr><td>Incorrect Answers</td><td>${incorrect}</td></tr>
        <tr><td>Unanswered</td><td>${unanswered}</td></tr>
        <tr><td>Your Score</td><td>${totalScore} / ${totalMarks}</td></tr>
    `;

    // --- NEW: SEND QUIZ RESULTS TO GOOGLE SHEET ---
    if (lastAccessCode && lastAccessCode !== 'N/A') {
        const resultsDataToSend = {
            type: 'quiz_result',
            accessCode: lastAccessCode,
            quizId: currentQuizId,
            totalQuestions: totalQuestions,
            correct: correct,
            incorrect: incorrect,
            unanswered: unanswered,
            totalScore: totalScore,
            totalMarks: totalMarks,
            studentName: savedStudentData['Student Name'] || 'Unknown' 
        };

        sendDataToSheet(resultsDataToSend)
            .then(response => {
                console.log('Sheet Results Update Response:', response);
            })
            .catch(error => {
                console.error('Sheet Results Update Error:', error);
                showQuizNotification('Submission Error', 'Failed to send results to the server sheet.', 'error');
            });
    }
    // ----------------------------------------------------


    const results = JSON.parse(localStorage.getItem('wcwQuizResults') || '[]');
    results.push({
        studentName: savedStudentData['Student Name'] || 'Unknown',
        accessCode: lastAccessCode,
        quizId: currentQuizId,
        totalQuestions: totalQuestions,
        correct: correct,
        incorrect: incorrect,
        unanswered: unanswered,
        totalScore: totalScore,
        totalMarks: totalMarks,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwQuizResults', JSON.stringify(results));
    
    showQuizNotification('Quiz Completed!', `Your score: ${totalScore}/${totalMarks}. Check the results page for details.`, 'info');
    
    showPage('results-page');
}

function restartTest() {
    if (confirm('Are you sure you want to retake the full test? Your current progress will be lost.')) {
        quizData = quizData_WCW_PHY_001;
        currentQuestion = 0;
        userAnswers = Array(quizData.length).fill(null);
        timeLeft = quizData.length * TIME_PER_MCQ;
        
        showPage('quiz-page');
        initQuiz();
    }
}

function retakeIncorrect() {
    const incorrectIndices = quizData.map((question, index) => {
        const isIncorrect = userAnswers[index] !== null && 
                            userAnswers[index] !== question.correctAnswer;
        return isIncorrect ? index : -1;
    }).filter(index => index !== -1);
    
    if (incorrectIndices.length === 0) {
        showQuizNotification('No Incorrect Questions', 'You have no incorrect questions to retake!', 'info');
        return;
    }
    
    quizData = incorrectIndices.map(index => quizData_WCW_PHY_001[index]);
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    timeLeft = quizData.length * TIME_PER_MCQ;
    
    showPage('quiz-page');
    initQuiz();
}

function viewAllMcqs() {
    allMcqsList.innerHTML = '';
    quizData_WCW_PHY_001.forEach((question, index) => {
        const mcqItem = document.createElement('div');
        mcqItem.classList.add('all-mcq-item');
        mcqItem.innerHTML = `
            <div class="question-text">${index + 1}. ${question.question}</div>
            <div class="all-mcq-options">
                ${question.options.map((option, optIndex) => `
                    <div class="all-mcq-option ${optIndex === question.correctAnswer ? 'correct' : ''}">
                        ${option}
                    </div>
                `).join('')}
            </div>
            <div class="all-mcq-reasoning">
                <strong>Reasoning:</strong> ${question.reasoning}
            </div>
        `;
        allMcqsList.appendChild(mcqItem);
    });
    showPage('all-mcqs-page');
}</script>